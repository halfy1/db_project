{% load static %}
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–û—Ç—á—ë—Ç—ã –ø–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class'
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .report-card {
            transition: all 0.3s ease;
        }
        .report-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        .dark .report-card:hover {
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .badge {
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }
        .dev-badge {
            background-color: #EFF6FF;
            color: #1D4ED8;
        }
        .dark .dev-badge {
            background-color: #1E3A8A;
            color: #DBEAFE;
        }
        .qa-badge {
            background-color: #ECFDF5;
            color: #047857;
        }
        .dark .qa-badge {
            background-color: #064E3B;
            color: #D1FAE5;
        }
        .theme-toggle {
            transition: all 0.3s ease;
        }
        .theme-toggle:hover {
            transform: rotate(30deg);
        }
        .dark .bg-gradient-to-r.from-blue-500.to-blue-600 {
            background: linear-gradient(to right, #1e40af, #1e3a8a);
        }
        .dark .bg-gradient-to-r.from-purple-500.to-purple-600 {
            background: linear-gradient(to right, #6b21a8, #5b21b6);
        }
        .dark .bg-gradient-to-r.from-indigo-500.to-indigo-600 {
            background: linear-gradient(to right, #4338ca, #3730a3);
        }
        .project-toggle {
            cursor: pointer;
            transition: all 0.2s;
        }
        .project-toggle:hover {
            background-color: rgba(79, 70, 229, 0.1);
        }
        .dark .project-toggle:hover {
            background-color: rgba(99, 102, 241, 0.1);
        }
        .project-toggle.active {
            background-color: rgba(79, 70, 229, 0.2);
            border-left: 3px solid #4f46e5;
        }
        .dark .project-toggle.active {
            background-color: rgba(99, 102, 241, 0.2);
            border-left: 3px solid #6366f1;
        }
        .grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
        }
        .chart-container {
            position: relative;
            height: 300px;
        }
        .legend-item {
            display: flex;
            align-items: center;
            cursor: pointer;
        }
        .legend-color {
            width: 16px;
            height: 16px;
            margin-right: 8px;
            border-radius: 3px;
        }
        .metric-card {
            transition: transform 0.3s ease;
        }
        .metric-card:hover {
            transform: scale(1.03);
        }
        .search-input {
            transition: all 0.3s ease;
        }
        .search-input:focus {
            box-shadow: 0 0 0 3px rgba(147, 197, 253, 0.5);
        }
        .employee-card {
            transition: all 0.3s ease;
        }
        .employee-card.hidden {
            opacity: 0;
            height: 0;
            margin: 0;
            padding: 0;
            border: 0;
            overflow: hidden;
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900">
    <div class="container mx-auto px-4 py-8">
        <header class="mb-10 relative">
            <div class="flex justify-between items-start">
                <div>
                    <h1 class="text-3xl font-bold text-gray-800 dark:text-white mb-2">üìä –û—Ç—á—ë—Ç—ã –ø–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</h1>
                    <p class="text-gray-600 dark:text-gray-300">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ —Ç–µ–∫—É—â–∏—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤ –∏ —Ä–∞–±–æ—Ç—ã –∫–æ–º–∞–Ω–¥—ã</p>
                </div>
                <div>
                    <button id="themeToggle" class="theme-toggle p-2 rounded-full bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-yellow-300">
                        <i class="fas fa-moon dark:hidden"></i>
                        <i class="fas fa-sun hidden dark:block"></i>
                    </button>
                </div>
            </div>
        </header>

        <div class="flex flex-col md:flex-row gap-6 mb-8">
            <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –æ—Ç—á—ë—Ç–∞–º -->
            <div class="md:w-1/4">
                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md p-6 sticky top-6">
                    <h2 class="text-xl font-semibold mb-4 text-gray-800 dark:text-white">–ú–µ–Ω—é –æ—Ç—á—ë—Ç–æ–≤</h2>
                    <nav>
                        <ul class="space-y-2">
                            <li>
                                <button onclick="showTab('current-projects')" class="tab-btn w-full text-left px-4 py-3 rounded-lg bg-blue-50 dark:bg-blue-900 text-blue-700 dark:text-blue-200 font-medium flex items-center">
                                    <i class="fas fa-tasks mr-3"></i> –¢–µ–∫—É—â–∏–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
                                </button>
                            </li>
                            <li>
                                <button onclick="showTab('employee-history')" class="tab-btn w-full text-left px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 font-medium flex items-center">
                                    <i class="fas fa-user-clock mr-3"></i> –ò—Å—Ç–æ—Ä–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
                                </button>
                            </li>
                            <li>
                                <button onclick="showTab('quality-metrics')" class="tab-btn w-full text-left px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 font-medium flex items-center">
                                    <i class="fas fa-chart-line mr-3"></i> –ö–∞—á–µ—Å—Ç–≤–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
                                </button>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div>

            <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –æ—Ç—á—ë—Ç–æ–≤ -->
            <div class="md:w-3/4">
                <!-- –û—Ç—á—ë—Ç 1: –¢–µ–∫—É—â–∏–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ -->
                <div id="current-projects" class="tab-content active">
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md overflow-hidden mb-8">
                        <div class="p-6 bg-gradient-to-r from-blue-500 to-blue-600">
                            <div class="flex justify-between items-center">
                                <h2 class="text-2xl font-bold text-white">üìå –¢–µ–∫—É—â–∏–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏</h2>
                                <span class="bg-white bg-opacity-20 px-3 py-1 rounded-full text-white text-sm font-medium">
                                    –ê–∫—Ç–∏–≤–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤: {{ metrics.total_active_projects }}
                                </span>
                            </div>
                            <p class="text-blue-100 dark:text-blue-200 mt-2">–ü—Ä–æ–µ–∫—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –µ—â—ë –Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω—ã –∏ –∫–æ–º–∞–Ω–¥—ã, —Ä–∞–±–æ—Ç–∞—é—â–∏–µ –Ω–∞–¥ –Ω–∏–º–∏</p>
                        </div>

                        <div class="p-6">
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                    <thead class="bg-gray-50 dark:bg-gray-700">
                                        <tr>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">–ü—Ä–æ–µ–∫—Ç</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">–ö–æ–º–∞–Ω–¥–∞</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">–ë–∞–≥-—Ç—Ä–µ–∫–µ—Ä</th>
                                        </tr>
                                    </thead>
                                    <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                        {% for project in active_projects %}
                                        <tr class="hover:bg-gray-50 dark:hover:bg-gray-700">
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <div class="font-medium text-gray-900 dark:text-white">{{ project.name }}</div>
                                                <div class="text-sm text-gray-500 dark:text-gray-400">
                                                    –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: {{ project.get_priority_display }}
                                                </div>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">
                                                {{ project.date_start|date:"d.m.Y" }}
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <div class="flex flex-wrap gap-2">
                                                    {% for member in project.current_members %}
                                                        <span class="badge {% if member.role == 'developer' %}dev-badge{% else %}qa-badge{% endif %}">
                                                            <i class="fas fa-{% if member.role == 'developer' %}code{% else %}vial{% endif %} mr-1"></i>
                                                            {{ member.user.last_name }} {{ member.user.first_name|first }}.
                                                        </span>
                                                    {% endfor %}
                                                </div>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <span class="px-2 py-1 text-xs font-medium rounded-full
                                                    {% if project.bug_count > 10 %}bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200
                                                    {% elif project.bug_count > 5 %}bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200
                                                    {% else %}bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200{% endif %}">
                                                    {{ project.bug_count }} –±–∞–≥–æ–≤
                                                </span>
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- –û—Ç—á—ë—Ç 2: –ò—Å—Ç–æ—Ä–∏—è —É—á–∞—Å—Ç–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ -->
                <div id="employee-history" class="tab-content">
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md overflow-hidden mb-8">
                        <div class="p-6 bg-gradient-to-r from-purple-500 to-purple-600">
                            <div class="flex justify-between items-center">
                                <h2 class="text-2xl font-bold text-white">üë®‚Äçüíª –ò—Å—Ç–æ—Ä–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</h2>
                                <span class="bg-white bg-opacity-20 px-3 py-1 rounded-full text-white text-sm font-medium">
                                    –ê–∫—Ç–∏–≤–Ω—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤: {{ metrics.total_active_employees }}
                                </span>
                            </div>
                            <p class="text-purple-100 dark:text-purple-200 mt-2">–ü—Ä–æ–µ–∫—Ç—ã, –≤ –∫–æ—Ç–æ—Ä—ã—Ö —É—á–∞—Å—Ç–≤–æ–≤–∞–ª –∫–∞–∂–¥—ã–π —Å–æ—Ç—Ä—É–¥–Ω–∏–∫</p>
                        </div>

                        <div class="p-6">
                            <div class="mb-6">
                                <div class="relative">
                                    <input id="employeeSearch" type="text" placeholder="–ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞..."
                                           class="search-input w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg px-4 py-2 pl-10 focus:outline-none focus:ring-2 focus:ring-purple-500">
                                    <div class="absolute left-3 top-2.5 text-gray-400 dark:text-gray-500">
                                        <i class="fas fa-search"></i>
                                    </div>
                                </div>
                            </div>

                            <ul id="searchResults" class="mt-2 space-y-1 text-sm text-gray-700 dark:text-white"></ul>

                            <div id="employeesContainer" class="space-y-6">
                                {% for employee in employees %}
                                <div class="employee-card report-card bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-6 shadow-sm"
                                     data-name="{{ employee.last_name }} {{ employee.first_name }}">
                                    <div class="flex items-start justify-between mb-4">
                                        <div>
                                            <h3 class="text-lg font-bold text-gray-800 dark:text-white">
                                                {{ employee.last_name }} {{ employee.first_name }}
                                            </h3>
                                            <p class="text-gray-600 dark:text-gray-300">
                                                {{ employee.get_position_display }}
                                            </p>
                                        </div>
                                        <div class="flex items-center">
                                            <span class="{% if employee.date_dismissal %}bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200{% else %}bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200{% endif %} text-xs font-medium px-2.5 py-0.5 rounded">
                                                {% if employee.date_dismissal %}–£–≤–æ–ª–µ–Ω{% else %}–ê–∫—Ç–∏–≤–µ–Ω{% endif %}
                                            </span>
                                        </div>
                                    </div>

                                    <div class="border-t border-gray-200 dark:border-gray-700 pt-4">
                                        <h4 class="font-medium text-gray-700 dark:text-gray-300 mb-3 flex items-center">
                                            <i class="fas fa-project-diagram mr-2 text-purple-500"></i>
                                            –£—á–∞—Å—Ç–∏–µ –≤ –ø—Ä–æ–µ–∫—Ç–∞—Ö ({{ employee.active_projects_count }} –∞–∫—Ç–∏–≤–Ω—ã—Ö)
                                        </h4>

                                        <div class="space-y-4">
                                            {% for participation in employee.current_projects %}
                                            <div class="pl-6 border-l-2 border-purple-200 dark:border-purple-800">
                                                <div class="flex justify-between">
                                                    <h5 class="font-medium text-gray-800 dark:text-white">{{ participation.project.name }}</h5>
                                                    <span class="text-sm text-gray-500 dark:text-gray-400">
                                                        —Å {{ participation.date_in|date:"d.m.Y" }}
                                                        {% if participation.date_out %}
                                                        –ø–æ {{ participation.date_out|date:"d.m.Y" }}
                                                        {% endif %}
                                                    </span>
                                                </div>
                                                <p class="text-sm text-gray-600 dark:text-gray-300 mt-1">
                                                    –†–æ–ª—å: {{ participation.get_role_display }}
                                                </p>
                                                <div class="mt-2 flex flex-wrap gap-2">
                                                    <span class="text-xs px-2 py-1
                                                        {% if participation.role == 'developer' %}bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200
                                                        {% else %}bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200{% endif %} rounded-full">
                                                        {{ participation.get_role_display }}
                                                    </span>
                                                </div>
                                            </div>
                                            {% endfor %}
                                        </div>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- –û—Ç—á—ë—Ç 3: –ö–∞—á–µ—Å—Ç–≤–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ -->
                <div id="quality-metrics" class="tab-content">
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md overflow-hidden mb-8">
                        <div class="p-6 bg-gradient-to-r from-indigo-500 to-indigo-600">
                            <div class="flex justify-between items-center">
                                <h2 class="text-2xl font-bold text-white">üìà –ö–∞—á–µ—Å—Ç–≤–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏</h2>
                                <span class="bg-white bg-opacity-20 px-3 py-1 rounded-full text-white text-sm font-medium">
                                    –û—Ç–∫—Ä—ã—Ç—ã—Ö –±–∞–≥–æ–≤: {{ metrics.open_bugs_count }}
                                </span>
                            </div>
                            <p class="text-indigo-100 dark:text-indigo-200 mt-2">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–∞–≥–æ–≤ –∏ —Å–∫–æ—Ä–æ—Å—Ç–∏ –∏—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è</p>
                        </div>

                        <div class="p-6">
                            <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–≤–µ—Ä—Ö—É -->
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                                <div class="metric-card bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-6 shadow-sm">
                                    <div class="flex items-center justify-between mb-4">
                                        <h3 class="text-lg font-medium text-gray-800 dark:text-white">–í—Å–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–æ–≤</h3>
                                        <div class="bg-indigo-100 dark:bg-indigo-900 text-indigo-800 dark:text-indigo-200 p-2 rounded-lg">
                                            <i class="fas fa-project-diagram"></i>
                                        </div>
                                    </div>
                                    <p class="text-3xl font-bold text-indigo-600 dark:text-indigo-400 mb-2">
                                        {{ metrics.total_active_projects }}
                                    </p>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">–≤–∫–ª—é—á–∞—è {{ active_projects|length }} –∞–∫—Ç–∏–≤–Ω—ã—Ö</p>
                                </div>

                                <div class="metric-card bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-6 shadow-sm">
                                    <div class="flex items-center justify-between mb-4">
                                        <h3 class="text-lg font-medium text-gray-800 dark:text-white">–û—Ç–∫—Ä—ã—Ç—ã—Ö –±–∞–≥–æ–≤</h3>
                                        <div class="bg-amber-100 dark:bg-amber-900 text-amber-800 dark:text-amber-200 p-2 rounded-lg">
                                            <i class="fas fa-bug"></i>
                                        </div>
                                    </div>
                                    <p class="text-3xl font-bold text-amber-600 dark:text-amber-400 mb-2">
                                        {{ metrics.open_bugs_count }}
                                    </p>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">–∏–∑ –Ω–∏—Ö {{ bugs|length }} –≤ –æ—Ç—á–µ—Ç–µ</p>
                                </div>

                                <div class="metric-card bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-6 shadow-sm">
                                    <div class="flex items-center justify-between mb-4">
                                        <h3 class="text-lg font-medium text-gray-800 dark:text-white">–ê–∫—Ç–∏–≤–Ω—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</h3>
                                        <div class="bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 p-2 rounded-lg">
                                            <i class="fas fa-users"></i>
                                        </div>
                                    </div>
                                    <p class="text-3xl font-bold text-green-600 dark:text-green-400 mb-2">
                                        {{ metrics.total_active_employees }}
                                    </p>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">–∏–∑ –Ω–∏—Ö {{ employees|length }} –≤ –æ—Ç—á–µ—Ç–µ</p>
                                </div>
                            </div>
                            <!-- –ì—Ä–∞—Ñ–∏–∫–∏ -->
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                                <!-- –û—Å–Ω–æ–≤–Ω–æ–π –≥—Ä–∞—Ñ–∏–∫ -->
                                <div class="report-card bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700 col-span-2">
                                    <h3 class="text-lg font-medium text-gray-800 dark:text-white mb-4">–î–∏–Ω–∞–º–∏–∫–∞ –±–∞–≥–æ–≤ –ø–æ –º–µ—Å—è—Ü–∞–º</h3>
                                    <div class="chart-container" style="position: relative; height: 300px;">
                                        <canvas id="mainChart"></canvas>
                                    </div>
                                    <div id="mainChartLegend" class="flex flex-wrap justify-center mt-4 gap-4"></div>
                                </div>

                                <div class="report-card bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700 col-span-2">
                                    <h3 class="text-lg font-medium text-gray-800 dark:text-white mb-4">–°–∫–æ—Ä–æ—Å—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è</h3>
                                    <div class="chart-container" style="position: relative; height: 300px;">
                                        <canvas id="fixSpeedChart"></canvas>
                                    </div>
                                </div>

                            </div>
                            </div>

                            <!-- –¢–∞–±–ª–∏—Ü–∞ –±–∞–≥–æ–≤ -->
                            <div class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-6 shadow-sm">
                                <h3 class="text-lg font-medium text-gray-800 dark:text-white mb-4">–ü–æ—Å–ª–µ–¥–Ω–∏–µ –±–∞–≥–∏</h3>
                                <div class="overflow-x-auto">
                                    <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                        <thead class="bg-gray-50 dark:bg-gray-700">
                                            <tr>
                                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">–ü—Ä–æ–µ–∫—Ç</th>
                                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">–§–∏—á–∞</th>
                                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">–û–ø–∏—Å–∞–Ω–∏–µ</th>
                                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç</th>
                                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">–°—Ç–∞—Ç—É—Å</th>
                                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">–°—Ä–æ–∫</th>
                                            </tr>
                                        </thead>
                                        <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                            {% for bug in bugs %}
                                            <tr class="hover:bg-gray-50 dark:hover:bg-gray-700">
                                                <td class="px-6 py-4 whitespace-nowrap">
                                                    <div class="font-medium text-gray-900 dark:text-white">{{ bug.project.name }}</div>
                                                    <div class="text-sm text-gray-500 dark:text-gray-400">
                                                        {{ bug.reported_at|date:"d.m.Y H:i" }}
                                                    </div>
                                                </td>
                                                <td class="px-6 py-4 whitespace-nowrap">
                                                    <div class="text-sm text-gray-900 dark:text-gray-300">
                                                        {{ bug.feature.name|truncatechars:30 }}
                                                    </div>
                                                </td>
                                                <td class="px-6 py-4">
                                                    <div class="text-sm text-gray-900 dark:text-gray-300">
                                                        {{ bug.description|truncatechars:50 }}
                                                    </div>
                                                </td>
                                                <td class="px-6 py-4 whitespace-nowrap">
                                                    <span class="px-2 py-1 text-xs font-medium rounded-full
                                                        {% if bug.priority == 'critical' %}bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200
                                                        {% elif bug.priority == 'high' %}bg-orange-100 dark:bg-orange-900 text-orange-800 dark:text-orange-200
                                                        {% else %}bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200{% endif %}">
                                                        {{ bug.get_priority_display }}
                                                    </span>
                                                </td>
                                                <td class="px-6 py-4 whitespace-nowrap">
                                                    {% if bug.fixed_at %}
                                                    <span class="px-2 py-1 text-xs font-medium rounded-full bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200">
                                                        –ò—Å–ø—Ä–∞–≤–ª–µ–Ω
                                                    </span>
                                                    {% elif bug.is_overdue %}
                                                    <span class="px-2 py-1 text-xs font-medium rounded-full bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200">
                                                        –ü—Ä–æ—Å—Ä–æ—á–µ–Ω
                                                    </span>
                                                    {% else %}
                                                    <span class="px-2 py-1 text-xs font-medium rounded-full bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200">
                                                        –í —Ä–∞–±–æ—Ç–µ
                                                    </span>
                                                    {% endif %}
                                                </td>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">
                                                    {{ bug.deadline|date:"d.m.Y" }}
                                                    {% if bug.is_overdue %}
                                                    <div class="text-xs text-red-500">+{{ bug.deadline|timesince:timezone.now }}</div>
                                                    {% endif %}
                                                </td>
                                            </tr>
                                            {% empty %}
                                            <tr>
                                                <td colspan="6" class="px-6 py-4 text-center text-gray-500 dark:text-gray-400">
                                                    –ù–µ—Ç –±–∞–≥–æ–≤ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
                                                </td>
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

<script>
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–æ–≤
    let bugsChart = null;
    let fixTimeChart = null;
    let qualityChart = null;

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–π —Ç–µ–º—ã
    if (localStorage.getItem('darkMode') === 'true') {
        document.documentElement.classList.add('dark');
    }

    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–µ–º—ã
    const themeToggle = document.getElementById('themeToggle');
    if (themeToggle) {
        themeToggle.addEventListener('click', () => {
            document.documentElement.classList.toggle('dark');
            localStorage.setItem('darkMode', document.documentElement.classList.contains('dark'));
            renderCharts();
        });
    }

    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –≤–∫–ª–∞–¥–∫–∞–º–∏
    function showTab(tabId) {
        // –°–∫—Ä—ã—Ç—å –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
        document.querySelectorAll('.tab-content').forEach(tab => {
            tab.classList.remove('active');
        });

        // –ü–æ–∫–∞–∑–∞—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—É—é –≤–∫–ª–∞–¥–∫—É
        const activeTab = document.getElementById(tabId);
        if (activeTab) {
            activeTab.classList.add('active');
        }

        // –û–±–Ω–æ–≤–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É –≤ –º–µ–Ω—é
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.classList.remove('bg-blue-50', 'dark:bg-blue-900', 'text-blue-700', 'dark:text-blue-200');
            btn.classList.add('hover:bg-gray-100', 'dark:hover:bg-gray-700', 'text-gray-700', 'dark:text-gray-300');
        });

        // –°–¥–µ–ª–∞—Ç—å –∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É –≤—ã–¥–µ–ª–µ–Ω–Ω–æ–π
        const activeBtn = document.querySelector(`.tab-btn[onclick="showTab('${tabId}')"]`);
        if (activeBtn) {
            activeBtn.classList.add('bg-blue-50', 'dark:bg-blue-900', 'text-blue-700', 'dark:text-blue-200');
            activeBtn.classList.remove('hover:bg-gray-100', 'dark:hover:bg-gray-700', 'text-gray-700', 'dark:text-gray-300');
        }

        // –ï—Å–ª–∏ —ç—Ç–æ –≤–∫–ª–∞–¥–∫–∞ —Å –≥—Ä–∞—Ñ–∏–∫–∞–º–∏, –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∞—Ç—å –∏—Ö
        if (tabId === 'quality-metrics') {
            setTimeout(renderCharts, 100);
        }
    }

    // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
    const employeeSelect = document.getElementById('employeeSelect');
    const employeeSearch = document.getElementById('employeeSearch');

    if (employeeSelect && employeeSearch) {
        employeeSelect.addEventListener('change', filterEmployees);
        employeeSearch.addEventListener('input', filterEmployees);
    }

    function filterEmployees() {
        const selectedId = employeeSelect ? employeeSelect.value : 'all';
        const searchTerm = employeeSearch ? employeeSearch.value.toLowerCase() : '';

        document.querySelectorAll('.employee-card').forEach(card => {
            const name = card.dataset.name ? card.dataset.name.toLowerCase() : '';
            const id = card.dataset.id || '';

            const matchesSearch = name.includes(searchTerm);
            const matchesSelect = selectedId === 'all' || id === selectedId;

            if (matchesSearch && matchesSelect) {
                card.classList.remove('hidden');
            } else {
                card.classList.add('hidden');
            }
        });
    }

    // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–æ–≤ –≤ —Ä–∞–∑–¥–µ–ª–µ –∫–∞—á–µ—Å—Ç–≤–∞
    document.querySelectorAll('.project-toggle').forEach(btn => {
        btn.addEventListener('click', function() {
            document.querySelectorAll('.project-toggle').forEach(b => {
                b.classList.remove('active', 'bg-indigo-600', 'dark:bg-indigo-700', 'text-white');
            });
            this.classList.add('active', 'bg-indigo-600', 'dark:bg-indigo-700', 'text-white');
            renderCharts();
        });
    });

    // –û–±—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–æ–≤
    function getChartOptions(yAxisTitle) {
        const isDark = document.documentElement.classList.contains('dark');
        return {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true,
                    grid: {
                        color: isDark ? '#374151' : '#E5E7EB',
                        drawBorder: false
                    },
                    ticks: {
                        color: isDark ? '#D1D5DB' : '#6B7280'
                    },
                    title: {
                        display: true,
                        text: yAxisTitle,
                        color: isDark ? '#D1D5DB' : '#6B7280'
                    }
                },
                x: {
                    grid: {
                        display: false,
                        drawBorder: false
                    },
                    ticks: {
                        color: isDark ? '#D1D5DB' : '#6B7280'
                    }
                }
            },
            plugins: {
                legend: {
                    position: 'top',
                    labels: {
                        color: isDark ? '#D1D5DB' : '#6B7280',
                        boxWidth: 12,
                        padding: 20,
                        font: {
                            size: 13
                        }
                    }
                },
                tooltip: {
                    backgroundColor: isDark ? '#1F2937' : '#FFFFFF',
                    titleColor: isDark ? '#E5E7EB' : '#111827',
                    bodyColor: isDark ? '#D1D5DB' : '#6B7280',
                    borderColor: '#9CA3AF',
                    borderWidth: 1,
                    padding: 12,
                    usePointStyle: true
                }
            }
        };
    }

    function renderCharts() {
        try {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ canvas —ç–ª–µ–º–µ–Ω—Ç–æ–≤
            const bugsCanvas = document.getElementById('mainChart');
            const fixTimeCanvas = document.getElementById('fixSpeedChart');

            if (!bugsCanvas || !fixTimeCanvas) {
                console.warn('Canvas elements not found for charts');
                return;
            }

            // –£–Ω–∏—á—Ç–æ–∂–∞–µ–º —Å—Ç–∞—Ä—ã–µ –≥—Ä–∞—Ñ–∏–∫–∏, –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å
            if (bugsChart) bugsChart.destroy();
            if (fixTimeChart) fixTimeChart.destroy();

            // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ Django template
            const chartData = {
                projects: {{ chart_data.projects|safe }},
                total_bugs: {{ chart_data.total_bugs|safe }},
                open_bugs: {{ chart_data.open_bugs|safe }},
                avg_fix_days: {{ chart_data.avg_fix_days|safe }},
                quality_scores: {{ chart_data.quality_scores|safe }}
            };

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
            if (chartData.projects.length === 0) {
                console.warn('No chart data available');
                return;
            }

            // –ì—Ä–∞—Ñ–∏–∫ 1: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–∞–≥–æ–≤
            bugsChart = new Chart(bugsCanvas, {
                type: 'bar',
                data: {
                    labels: chartData.projects,
                    datasets: [
                        {
                            label: '–í—Å–µ –±–∞–≥–∏',
                            data: chartData.total_bugs,
                            backgroundColor: '#6366F1',
                            borderColor: '#4F46E5',
                            borderWidth: 1
                        },
                        {
                            label: '–û—Ç–∫—Ä—ã—Ç—ã–µ –±–∞–≥–∏',
                            data: chartData.open_bugs,
                            backgroundColor: '#EC4899',
                            borderColor: '#DB2777',
                            borderWidth: 1
                        }
                    ]
                },
                options: getChartOptions('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞–≥–æ–≤')
            });

            // –ì—Ä–∞—Ñ–∏–∫ 2: –í—Ä–µ–º—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–∞–≥–æ–≤
            fixTimeChart = new Chart(fixTimeCanvas, {
                type: 'line',
                data: {
                    labels: chartData.projects,
                    datasets: [{
                        label: '–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–¥–Ω–∏)',
                        data: chartData.avg_fix_days,
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        borderColor: '#10B981',
                        borderWidth: 2,
                        tension: 0.3,
                        fill: true,
                        pointBackgroundColor: '#FFFFFF',
                        pointBorderColor: '#10B981',
                        pointBorderWidth: 2,
                        pointRadius: 4,
                        pointHoverRadius: 6
                    }]
                },
                options: getChartOptions('–î–Ω–∏')
            });
        } catch (error) {
            console.error('Error rendering charts:', error);
        }
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
    const resizeHandler = () => {
        if (bugsChart || fixTimeChart) {
            renderCharts();
        }
    };
    window.addEventListener('resize', resizeHandler);

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    document.addEventListener('DOMContentLoaded', function() {
        // –ü–æ–∫–∞–∑–∞—Ç—å –ø–µ—Ä–≤—É—é –≤–∫–ª–∞–¥–∫—É
        showTab('current-projects');

        // –ï—Å–ª–∏ —Å—Ä–∞–∑—É –æ—Ç–∫—Ä—ã—Ç–∞ –≤–∫–ª–∞–¥–∫–∞ —Å –≥—Ä–∞—Ñ–∏–∫–∞–º–∏
        if (document.getElementById('quality-metrics')?.classList.contains('active')) {
            setTimeout(renderCharts, 100);
        }
    });

    // –û—á–∏—Å—Ç–∫–∞ –ø—Ä–∏ —Ä–∞–∑–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
    window.addEventListener('beforeunload', () => {
        window.removeEventListener('resize', resizeHandler);
    });
</script>

</body>
</html>